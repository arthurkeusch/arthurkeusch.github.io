<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <link href="styles/index.css" rel="stylesheet" type="text/css">
    <title>Code Explorer</title>
    <link href="images/logo.jpg" rel="icon" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <div class="container-fluid justify-content-evenly d-flex">
        <a class="navbar-brand" href="./index.html">CV</a>
        <a class="navbar-brand" href="./portfolio.html">Portfolio</a>
        <a class="navbar-brand" href="./portfolio_stage.html">Portfolio Stage</a>
        <a class="navbar-brand" href="./code.html">Code</a>
    </div>
</nav>

<div class="container-fluid" style="margin-top: 80px; height: calc(100vh - 80px);">
    <div class="row" style="height: 100%;">
        <div class="col-3" style="height: 100%; overflow-y: auto; border-right: 1px solid #ccc;">
            <div id="file-tree-container" class="p-2">
                <ul id="file-tree" class="list-unstyled"></ul>
            </div>
        </div>
        <div class="col-9" style="height: 100%;">
            <div id="code-editor-container" class="p-2" style="height: 100%;">
                <textarea id="code-editor" class="code-editor"></textarea>
            </div>
        </div>
    </div>
</div>

<style>
    html, body {
        height: 100%;
        margin: 0;
        overflow: hidden; /* Supprimer la scrollbar de la page */
    }

    .code-editor {
        height: 100%;
        width: 100%;
        border: 1px solid #ccc;
        overflow: auto;
    }

    #file-tree-container {
        height: 100%;
        overflow-y: auto;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialiser CodeMirror
        var editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
            mode: "javascript",
            lineNumbers: true,
            readOnly: true
        });

        // Fragments du token
        const part1 = 'ghp_';
        const part2 = '0cckkaGfVw9ThX4c';
        const part3 = 'wTUYHZeWsyfq';
        const part4 = 'Jm0oanxV';

        // Reconstruction du token
        const githubToken = part1 + part2 + part3 + part4;

        // Fonction pour déterminer le mode en fonction du type de fichier
        function determineMode(filePath) {
            if (filePath.endsWith('.js')) return 'javascript';
            if (filePath.endsWith('.php')) return 'php';
            if (filePath.endsWith('.html') || filePath.endsWith('.twig')) return 'htmlmixed';
            // Ajoutez d'autres conditions selon les types de fichiers
            return '';
        }

        // Fonction pour créer l'arborescence des fichiers
        function createFileTree(files, parentElement) {
            if (!Array.isArray(files)) {
                console.error('Files is not an array', files);
                return;
            }
            files.forEach(file => {
                let listItem = document.createElement('li');
                listItem.textContent = file.name;
                listItem.dataset.file = file.path;

                if (file.type === 'dir') {
                    let sublist = document.createElement('ul');
                    listItem.appendChild(sublist);

                    fetch(`https://api.github.com/repos/arthurkeusch/arthurkeusch.github.io/contents/${file.path}`, {
                        headers: {
                            'Authorization': `token ${githubToken}`
                        }
                    })
                        .then(response => response.json())
                        .then(subfiles => createFileTree(subfiles, sublist))
                        .catch(error => console.error('Error fetching directory contents:', error));
                } else {
                    listItem.addEventListener('click', function () {
                        fetch(`https://raw.githubusercontent.com/arthurkeusch/arthurkeusch.github.io/main/${file.path}`, {
                            // Pas d'en-tête d'autorisation ici
                        })
                            .then(response => response.text())
                            .then(data => {
                                editor.setValue(data);
                                editor.setOption('mode', determineMode(file.path));
                            })
                            .catch(error => console.error('Error fetching file contents:', error));
                    });
                }

                parentElement.appendChild(listItem);
            });
        }

        // Récupérer la structure des fichiers depuis GitHub
        fetch('https://api.github.com/repos/arthurkeusch/arthurkeusch.github.io/contents/ai-tools-monitor-main', {
            headers: {
                'Authorization': `token ${githubToken}`
            }
        })
            .then(response => response.json())
            .then(files => {
                let fileTree = document.getElementById('file-tree');
                createFileTree(files, fileTree);
            })
            .catch(error => console.error('Error fetching file tree:', error));
    });
</script>
</body>
</html>